<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Air Drum Stick</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        touch-action: manipulation;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
        color: white;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        background: linear-gradient(to right, #ff8a00, #da1b60);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 20px;
      }

      .dashboard {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
        margin-bottom: 30px;
      }

      @media (min-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr 1fr;
        }
      }

      .panel {
        background: rgba(20, 20, 40, 0.7);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
      }

      h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
        text-align: center;
        color: #ff8a00;
      }

      .drum-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 20px;
        margin-top: 25px;
      }

      .drum-pad {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px 15px;
        transition: all 0.2s ease;
        cursor: pointer;
        border: 2px solid transparent;
        height: 180px;
      }

      .drum-pad:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .drum-pad.active {
        transform: scale(1.05);
        border-color: #ff8a00;
        background: rgba(255, 138, 0, 0.2);
        box-shadow: 0 0 20px rgba(255, 138, 0, 0.4);
      }

      .drum-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        transition: transform 0.3s ease;
      }

      .drum-pad.active .drum-icon {
        transform: scale(1.2);
      }

      .drum-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .drum-motion {
        font-size: 0.9rem;
        text-align: center;
        color: #aaa;
        min-height: 40px;
      }

      .visualizer {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        position: relative;
        margin-top: 20px;
      }

      .phone-model {
        width: 120px;
        height: 220px;
        background: #222;
        border-radius: 20px;
        position: relative;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        border: 4px solid #444;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      .phone-screen {
        width: 90%;
        height: 92%;
        background: #1a1a2e;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 15px;
      }

      .motion-display {
        font-size: 0.9rem;
        text-align: center;
        margin-top: 10px;
      }

      .motion-direction {
        font-size: 2.5rem;
        margin: 10px 0;
      }

      .sensor-data {
        font-size: 0.8rem;
        color: #aaa;
        margin-top: 5px;
      }

      .instructions {
        margin-top: 30px;
      }

      .instructions ul {
        padding-left: 25px;
        margin-top: 15px;
      }

      .instructions li {
        margin-bottom: 12px;
        line-height: 1.5;
      }

      .control-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
      }

      button {
        background: linear-gradient(to right, #ff8a00, #da1b60);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      }

      button:active {
        transform: translateY(1px);
      }

      .status {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        font-weight: 600;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .status.active {
        background: rgba(40, 167, 69, 0.3);
        color: #28a745;
      }

      .status.error {
        background: rgba(220, 53, 69, 0.3);
        color: #dc3545;
      }

      footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        font-size: 0.9rem;
        color: #aaa;
      }

      .hit-animation {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 20px;
        pointer-events: none;
        opacity: 0;
      }

      @keyframes hit {
        0% {
          transform: scale(0.8);
          opacity: 0.8;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }

      .hit-hihat {
        background: radial-gradient(
          circle,
          rgba(0, 200, 255, 0.5),
          transparent
        );
      }
      .hit-snare {
        background: radial-gradient(
          circle,
          rgba(255, 50, 100, 0.5),
          transparent
        );
      }
      .hit-tom {
        background: radial-gradient(
          circle,
          rgba(100, 255, 100, 0.5),
          transparent
        );
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Air Drum Stick</h1>
        <p class="subtitle">
          Move your phone like drumsticks to play virtual drums
        </p>
      </header>

      <div class="dashboard">
        <div class="panel">
          <h2>Drum Kit</h2>
          <div class="drum-controls">
            <div class="drum-pad" data-sound="hihat" id="hihat-pad">
              <div class="drum-icon">ü•Å</div>
              <div class="drum-name">Hi-hat</div>
              <div class="drum-motion">Quick downward flick</div>
            </div>
            <div class="drum-pad" data-sound="snare" id="snare-pad">
              <div class="drum-icon">üéµ</div>
              <div class="drum-name">Snare</div>
              <div class="drum-motion">Medium power stroke</div>
            </div>
            <div class="drum-pad" data-sound="tom" id="tom-pad">
              <div class="drum-icon">üé∂</div>
              <div class="drum-name">Tom</div>
              <div class="drum-motion">Wide circular motion</div>
            </div>
          </div>

          <div class="visualizer">
            <div class="phone-model">
              <div class="phone-screen">
                <div>PHONE ORIENTATION</div>
                <div class="motion-direction">‚Üë</div>
                <div class="motion-display">Hold like drumstick</div>
                <div class="sensor-data">x: 0.00 | y: 0.00 | z: 0.00</div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>How to Play</h2>
          <div class="instructions">
            <p>Hold your phone like a drumstick and make these movements:</p>
            <ul>
              <li>
                <strong>Hi-hat</strong>: Quick downward flick (wrist motion)
              </li>
              <li>
                <strong>Snare</strong>: Medium power stroke (elbow motion)
              </li>
              <li>
                <strong>Tom</strong>: Wide circular motion (shoulder motion)
              </li>
            </ul>

            <p style="margin-top: 20px"><strong>Pro Tips:</strong></p>
            <ul>
              <li>Hold phone firmly but not too tightly</li>
              <li>Make distinct, deliberate movements</li>
              <li>Start with slow rhythms to calibrate</li>
              <li>Move your entire arm, not just the wrist</li>
            </ul>
          </div>

          <div class="control-buttons">
            <button id="start-btn">Start Motion Detection</button>
            <button id="calibrate-btn">Calibrate Sensitivity</button>
          </div>

          <div class="status" id="status">
            Motion detection is not active. Click "Start Motion Detection"
          </div>
        </div>
      </div>

      <footer>
        <p>
          Hold your phone securely. Works best in portrait orientation. Requires
          motion sensor permissions.
        </p>
      </footer>
    </div>

    <script>
      // DOM elements
      const startBtn = document.getElementById("start-btn");
      const calibrateBtn = document.getElementById("calibrate-btn");
      const statusDiv = document.getElementById("status");
      const motionDirection = document.querySelector(".motion-direction");
      const motionDisplay = document.querySelector(".motion-display");
      const sensorData = document.querySelector(".sensor-data");
      const drumPads = document.querySelectorAll(".drum-pad");

      // Audio context and sounds
      const audioContext = new (window.AudioContext ||
        window.webkitAudioContext)();
      const sounds = {};
      const soundFiles = {
        hihat: "sound/hihat.wav",
        snare: "sound/snare.wave",
        tom: "sound/tom.wave",
      };

      // Motion detection variables
      let isMonitoring = false;
      let lastAcceleration = { x: 0, y: 0, z: 0 };
      let lastHitTime = 0;
      const hitCooldown = 200; // milliseconds
      let sensitivity = 15; // Default sensitivity

      // Load drum sounds
      async function loadSounds() {
        for (const [drum, url] of Object.entries(soundFiles)) {
          try {
            const response = await fetch(url);
            const arrayBuffer = await response.arrayBuffer();
            sounds[drum] = await audioContext.decodeAudioData(arrayBuffer);
          } catch (error) {
            console.error(`Error loading sound for ${drum}:`, error);
          }
        }
      }

      // Play sound function
      function playSound(drumType) {
        if (sounds[drumType]) {
          const source = audioContext.createBufferSource();
          source.buffer = sounds[drumType];
          source.connect(audioContext.destination);
          source.start();

          // Visual feedback
          const pad = document.getElementById(`${drumType}-pad`);
          pad.classList.add("active");
          setTimeout(() => pad.classList.remove("active"), 200);

          // Create hit animation
          const hitAnim = document.createElement("div");
          hitAnim.className = `hit-animation hit-${drumType}`;
          document.body.appendChild(hitAnim);

          // Position animation near the drum pad
          const rect = pad.getBoundingClientRect();
          hitAnim.style.left = `${rect.left + rect.width / 2}px`;
          hitAnim.style.top = `${rect.top + rect.height / 2}px`;

          // Animate
          hitAnim.style.animation = "hit 0.5s forwards";

          // Clean up after animation
          setTimeout(() => {
            document.body.removeChild(hitAnim);
          }, 500);
        }
      }

      // Handle motion events
      function handleMotion(event) {
        if (!isMonitoring) return;

        const acceleration = event.accelerationIncludingGravity;
        const now = Date.now();

        // Update visualizer
        motionDirection.textContent = getMotionDirection(acceleration);
        sensorData.textContent = `x: ${acceleration.x.toFixed(
          2
        )} | y: ${acceleration.y.toFixed(2)} | z: ${acceleration.z.toFixed(2)}`;

        // Calculate acceleration change
        const deltaX = Math.abs(acceleration.x - lastAcceleration.x);
        const deltaY = Math.abs(acceleration.y - lastAcceleration.y);
        const deltaZ = Math.abs(acceleration.z - lastAcceleration.z);

        // Update last acceleration
        lastAcceleration = {
          x: acceleration.x,
          y: acceleration.y,
          z: acceleration.z,
        };

        // Check if we're in cooldown period
        if (now - lastHitTime < hitCooldown) return;

        // Determine which drum to play based on movement pattern
        if (deltaZ > sensitivity && deltaZ > deltaX && deltaZ > deltaY) {
          // Z-axis movement (up/down) - Hi-hat
          playSound("hihat");
          motionDisplay.textContent = "Playing: Hi-hat";
          lastHitTime = now;
        } else if (deltaX > sensitivity && deltaX > deltaY && deltaX > deltaZ) {
          // X-axis movement (side to side) - Snare
          playSound("snare");
          motionDisplay.textContent = "Playing: Snare";
          lastHitTime = now;
        } else if (deltaY > sensitivity && deltaY > deltaX && deltaY > deltaZ) {
          // Y-axis movement (forward/backward) - Tom
          playSound("tom");
          motionDisplay.textContent = "Playing: Tom";
          lastHitTime = now;
        }
      }

      // Determine motion direction for visual feedback
      function getMotionDirection(acc) {
        const absX = Math.abs(acc.x);
        const absY = Math.abs(acc.y);
        const absZ = Math.abs(acc.z);

        if (absZ > absX && absZ > absY) {
          return acc.z > 0 ? "‚Üì" : "‚Üë";
        } else if (absX > absY && absX > absZ) {
          return acc.x > 0 ? "‚Üí" : "‚Üê";
        } else {
          return acc.y > 0 ? "‚Üò" : "‚Üó";
        }
      }

      // Start motion detection
      function startMotionDetection() {
        if (typeof DeviceMotionEvent.requestPermission === "function") {
          DeviceMotionEvent.requestPermission()
            .then((permissionState) => {
              if (permissionState === "granted") {
                enableMotionDetection();
              } else {
                statusDiv.textContent =
                  "Permission denied. Please enable motion access.";
                statusDiv.classList.add("error");
              }
            })
            .catch(console.error);
        } else {
          // Non-iOS devices
          enableMotionDetection();
        }
      }

      function enableMotionDetection() {
        window.addEventListener("devicemotion", handleMotion);
        isMonitoring = true;
        statusDiv.textContent =
          "Motion detection active! Move your phone to play drums.";
        statusDiv.classList.add("active");
        statusDiv.classList.remove("error");

        // Initialize last acceleration
        if (window.DeviceMotionEvent) {
          window.addEventListener(
            "devicemotion",
            (event) => {
              lastAcceleration = {
                x: event.accelerationIncludingGravity.x,
                y: event.accelerationIncludingGravity.y,
                z: event.accelerationIncludingGravity.z,
              };
            },
            { once: true }
          );
        }
      }

      // Calibrate sensitivity
      function calibrateSensitivity() {
        sensitivity = 10; // Reset to default
        statusDiv.textContent = "Calibrating... Make drumming motions.";

        setTimeout(() => {
          statusDiv.textContent = "Calibration complete. Sensitivity adjusted.";
          setTimeout(() => {
            statusDiv.textContent =
              "Motion detection active! Move your phone to play drums.";
          }, 2000);
        }, 3000);
      }

      // Manual drum pad click
      drumPads.forEach((pad) => {
        pad.addEventListener("click", () => {
          const sound = pad.getAttribute("data-sound");
          playSound(sound);
        });
      });

      // Button event listeners
      startBtn.addEventListener("click", startMotionDetection);
      calibrateBtn.addEventListener("click", calibrateSensitivity);

      // Initialize
      loadSounds();

      // Touch prevention for mobile
      document.addEventListener(
        "touchstart",
        function (e) {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        },
        { passive: false }
      );

      // Prevent elastic scrolling on iOS
      document.body.addEventListener(
        "touchmove",
        function (e) {
          if (e.scale !== 1) {
            e.preventDefault();
          }
        },
        { passive: false }
      );
    </script>
  </body>
</html>
